#!/bin/bash

current_dir=`pwd`
cmd_path=`which 0gvim`

if [[ x$cmd_path == x ]]
then
    echo "Not found 0gvim"
    exit 0
fi

if [ ! -L /etc/alternatives/gvim ]
then
    sudo update-alternatives --install /usr/bin/gvim gvim $cmd_path 100
fi

rel_path=`readlink /etc/alternatives/gvim`
if [[ x$rel_path != x$cmd_path ]]
then
    sudo update-alternatives --set gvim $cmd_path
fi

ss=`vim --serverlist | head -n1`
if [[ x$ss == x"QRS" ]]
then
    if [[ x$@ != x ]]
    then
        have=`echo "$@" | grep servername`
        if [[ x$have == x ]]
        then
            vim -g -p --servername QRS --remote-tab-silent $@
        else
            vim -g $@
        fi
    else 
        vim -g -p --servername QRS --remote-send ":NERDTree $current_dir <cr>"
    fi
else
    vim -g -p --servername QRS $@
fi
